<!DOCTYPE html>
<html>
  <head>
    <title>Locator</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/handlebars/4.7.7/handlebars.min.js"></script>
    <link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
    <style>
      /* Your CSS styles */
    </style>
    <script>
      'use strict';

      /** Hide a DOM element. */
      function hideElement(el) {
        el.style.display = 'none';
      }

      /** Show a DOM element that has been hidden. */
      function showElement(el) {
        el.style.display = 'block';
      }

      /** Helper function to generate a Google Maps directions URL */
      function generateDirectionsURL(origin, destination) {
        const googleMapsUrlBase = 'https://www.google.com/maps/dir/?';
        const searchParams = new URLSearchParams('api=1');
        searchParams.append('origin', origin);
        const destinationParam = [];
        if (destination.title !== destination.address1) {
          destinationParam.push(destination.title);
        }
        destinationParam.push(destination.address1, destination.address2);
        searchParams.append('destination', destinationParam.join(','));
        return googleMapsUrlBase + searchParams.toString();
      }

      function LocatorPlus(configuration) {
        const locator = this;

        locator.locations = configuration.locations || [];
        locator.capabilities = configuration.capabilities || {};

        const mapEl = document.getElementById('gmp-map');
        const panelEl = document.getElementById('locations-panel');
        locator.panelListEl = document.getElementById('locations-panel-list');
        const sectionNameEl = document.getElementById('location-results-section-name');
        const resultsContainerEl = document.getElementById('location-results-list');

        const itemsTemplate = Handlebars.compile(
            document.getElementById('locator-result-items-tmpl').innerHTML);

        locator.searchLocation = null;
        locator.searchLocationMarker = null;
        locator.selectedLocationIdx = null;
        locator.userCountry = null;

        // Initialize the map
        locator.map = new google.maps.Map(mapEl, configuration.mapOptions);

        const selectResultItem = function(locationIdx, panToMarker, scrollToResult) {
          locator.selectedLocationIdx = locationIdx;
          for (let locationElem of resultsContainerEl.children) {
            locationElem.classList.remove('selected');
            if (parseInt(locationElem.getAttribute('data-location-index')) === locator.selectedLocationIdx) {
              locationElem.classList.add('selected');
              if (scrollToResult) {
                panelEl.scrollTop = locationElem.offsetTop;
              }
            }
          }
          if (panToMarker && (locationIdx != null)) {
            locator.map.panTo(locator.locations[locationIdx].coords);
          }
        };

        const markers = locator.locations.map(function(location, index) {
          const marker = new google.maps.Marker({
            position: location.coords,
            map: locator.map,
            title: location.title,
            icon: {
              url: "https://scubaworld1.github.io/scubaworld/logo-main-circle.png",
              scaledSize: new google.maps.Size(40, 40),
            }
          });
          marker.addListener('click', function() {
            selectResultItem(index, false, true);
          });
          return marker;
        });

        locator.updateBounds = function() {
          const bounds = new google.maps.LatLngBounds();
          if (locator.searchLocationMarker) {
            bounds.extend(locator.searchLocationMarker.getPosition());
          }
          for (let i = 0; i < markers.length; i++) {
            bounds.extend(markers[i].getPosition());
          }
        };

        locator.renderResultsList = function() {
          let locations = locator.locations.slice();
          for (let i = 0; i < locations.length; i++) {
            locations[i].index = i;
          }
          if (locator.searchLocation) {
            sectionNameEl.textContent = 'Nearest locations (' + locations.length + ')';
            locations.sort(function(a, b) {
              return getLocationDistance(a) - getLocationDistance(b);
            });
          } else {
            sectionNameEl.textContent = `All locations (${locations.length})`;
          }
          const resultItemContext = { locations: locations };
          resultsContainerEl.innerHTML = itemsTemplate(resultItemContext);

          for (let item of resultsContainerEl.children) {
            const resultIndex = parseInt(item.getAttribute('data-location-index'));
            if (resultIndex === locator.selectedLocationIdx) {
              item.classList.add('selected');
            }

            const resultSelectionHandler = function() {
              if (resultIndex !== locator.selectedLocationIdx) {
                selectResultItem(resultIndex, true, false);
                locator.updateDirections();
              }
            };

            item.addEventListener('click', resultSelectionHandler);
            item.querySelector('.select-location')
                .addEventListener('click', function(e) {
                  resultSelectionHandler();
                  e.stopPropagation();
                });

            item.querySelector('.details-button')
                .addEventListener('click', function() {
                  locator.showDetails(resultIndex);
                });

            const origin = (locator.searchLocation != null) ?
                locator.searchLocation.location :
                '';
            const destination = locator.locations[resultIndex];
            const googleMapsUrl = generateDirectionsURL(origin, destination);
            item.querySelector('.directions-button')
                .setAttribute('href', googleMapsUrl);
          }
        };

        // Other initializations (Search, Distance Matrix, Directions, Details)...
      }

      function initMap() {
        const EGYPT_BOUNDS = {
          north: 31.743530098039933,
          south: 21.85182102204757,
          west: 21.681974538347,
          east: 38.303225724494986
        };

        const CONFIGURATION = {
          "locations": [
            {"title":"Scuba World Divers Marsa Alam Lagoon View Hotel","address1":"LAGOON VIEW RESORTS","address2":"MARSA ALAM, Red Sea Governorate, Egypt","coords":{"lat":24.9137237,"lng":34.9710754},"placeId":"ChIJAQAAAPTptBURcTj0vAGaLa8"},
            {"title":"Scuba World Divers Makadi Bay","address1":"Makadi Bay","address2":"Qesm Hurghada, Egypt","coords":{"lat":26.9917033,"lng":33.899044},"placeId":"ChIJIRtmt_d7TRQRpubUEEhnbuI"},
            {"title":"Scuba World Divers Soma Bay","address1":"Mövenpick Resort Soma Bay","address2":"Safaga, Red Sea Governorate, Egypt","coords":{"lat":26.8280601,"lng":33.941986},"placeId":"ChIJUyTHi5ZxTRQRJRB8O73ZNOY"},
            {"title":"Scuba World Divers - Iberotel Costa Mares","address1":"Iberotel Costa Mares","address2":"القصير, البحر الأحمر, Egypt","coords":{"lat":25.5083078,"lng":34.6494284},"placeId":"ChIJ9aZFK-uzTBQRODplY_3pas0"},
            {"title":"Scuba World Divers - Mövenpick Resort \u0026 Spa El Gouna","address1":"Movenpick Hotel ElGouna","address2":"Hurghada, Red Sea Governorate, Egypt","coords":{"lat":27.3919853,"lng":33.6863049},"placeId":"ChIJ8fimvOxmUhQReDme1CAfm24"},
            {"title":"Scuba World Divers Solymar Reef Marsa / Jaz Grand Marsa","address1":"El Qoseir, Red Sea Governorate 1927220","address2":"Marsa Alam, Red Sea Governorate, Egypt","coords":{"lat":25.5977225,"lng":34.6099508},"placeId":"ChIJIQKB9pbBtBURIQhaicXuYh4"},
            {"title":"Scuba World Divers Solymar Soma Beach","address1":"Solymar Soma Beach","address2":"Soma Bay, Red Sea Governorate, Egypt","coords":{"lat":26.8326003,"lng":33.9459987},"placeId":"ChIJfbhamGtxTRQRcwMggJJyNxk"},
            {"title":"Scuba World - Sheraton Miramar Resort El Gouna","address1":"El Gouna","address2":"Hurghada, Red Sea Governorate, Egypt","coords":{"lat":27.4062106,"lng":33.6783936},"placeId":"ChIJzcUOaQVnUhQR0JQspinhNDM"},
            {"title":"Scuba World Divers - Amarina Jannah Resort & Aqua Park","address1":"Marsa Alam","address2":"Marsa Alam, Red Sea Governorate, Egypt","coords":{"lat":25.5848124,"lng":34.6278555},"placeId":"ChIJVeokvbNXsxURjZy4rWgf4k0"}
          ],
          "mapOptions": {
            restriction: { latLngBounds: EGYPT_BOUNDS },
            "center": { "lat": 26.9917033, "lng": 33.899044 },
            "fullscreenControl": true,
            "mapTypeId": 'roadmap',
            "mapTypeControl": false,
            "streetViewControl": false,
            "zoom": 4,
            "zoomControl": true,
            "maxZoom": 17,
            "styles": [
              {
                  "featureType": "all",
                  "elementType": "labels.text.fill",
                  "stylers": [
                      {
                          "color": "#ffffff"
                      }
                  ]
              },
              {
                  "featureType": "all",
                  "elementType": "labels.text.stroke",
                  "stylers": [
                      {
                          "color": "#000000"
                      },
                      {
                          "lightness": 13
                      }
                  ]
              },
              {
                  "featureType": "administrative",
                  "elementType": "geometry.fill",
                  "stylers": [
                      {
                          "color": "#000000"
                      }
                  ]
              },
              {
                  "featureType": "administrative",
                  "elementType": "geometry.stroke",
                  "stylers": [
                      {
                          "color": "#144b53"
                      },
                      {
                          "lightness": 14
                      },
                      {
                          "weight": 1.4
                      }
                  ]
              },
              {
                  "featureType": "landscape",
                  "elementType": "all",
                  "stylers": [
                      {
                          "color": "#08304b"
                      }
                  ]
              },
              {
                  "featureType": "poi",
                  "elementType": "geometry",
                  "stylers": [
                      {
                          "color": "#0c4152"
                      },
                      {
                          "lightness": 5
                      }
                  ]
              },
              {
                  "featureType": "road.highway",
                  "elementType": "geometry.fill",
                  "stylers": [
                      {
                          "color": "#000000"
                      }
                  ]
              },
              {
                  "featureType": "road.highway",
                  "elementType": "geometry.stroke",
                  "stylers": [
                      {
                          "color": "#0b434f"
                      },
                      {
                          "lightness": 25
                      }
                  ]
              },
              {
                  "featureType": "road.arterial",
                  "elementType": "geometry.fill",
                  "stylers": [
                      {
                          "color": "#000000"
                      }
                  ]
              },
              {
                  "featureType": "road.arterial",
                  "elementType": "geometry.stroke",
                  "stylers": [
                      {
                          "color": "#0b3d51"
                      },
                      {
                          "lightness": 16
                      }
                  ]
              },
              {
                  "featureType": "road.local",
                  "elementType": "geometry",
                  "stylers": [
                      {
                          "color": "#000000"
                      }
                  ]
              },
              {
                  "featureType": "transit",
                  "elementType": "all",
                  "stylers": [
                      {
                          "color": "#146474"
                      }
                  ]
              },
              {
                  "featureType": "water",
                  "elementType": "all",
                  "stylers": [
                      {
                          "color": "#021019"
                      }
                  ]
              }
            ]
          },
          "mapsApiKey": "AIzaSyBUl0wCqN7qA_AaUjsPQ72iFu9IubWJaG4",
          "capabilities": {"input":true,"autocomplete":true,"directions":true,"distanceMatrix":true,"details":true,"actions":false}
        };

        new LocatorPlus(CONFIGURATION);
      }
    </script>
    <script id="locator-result-items-tmpl" type="text/x-handlebars-template">
      <!-- Your template code -->
    </script>
    <script id="locator-details-tmpl" type="text/x-handlebars-template">
      <!-- Your template code -->
    </script>
  </head>
  <body>
    <div id="map-container">
      <div id="locations-panel">
        <div id="locations-panel-list">
          <header>
            <h1 class="search-title">
              <img src="https://fonts.gstatic.com/s/i/googlematerialicons/place/v15/24px.svg" alt=""/>
              Hotel Name
            </h1>
            <div class="search-input">
              <input id="location-search-input" placeholder="Enter your address or zip code">
              <div id="search-overlay-search" class="search-input-overlay search">
                <button id="location-search-button">
                  <img class="icon" src="https://fonts.gstatic.com/s/i/googlematerialicons/search/v11/24px.svg" alt="Search"/>
                </button>
              </div>
            </div>
          </header>
          <div class="section-name" id="location-results-section-name">
            All locations
          </div>
          <div class="results">
            <ul id="location-results-list"></ul>
          </div>
        </div>
        <div id="locations-panel-details"></div>
      </div>
      <div id="gmp-map"></div>
    </div>
    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&callback=initMap&libraries=places,geometry&solution_channel=GMP_QB_locatorplus_v9_cABCDE" async defer></script>
  </body>
</html>
